package practica12;

import SM.RRA.GRAFICOS.Forma;
import SM.RRA.IMAGENES.AzulOp;
import SM.RRA.IMAGENES.PosterizarOp;
import SM.RRA.IMAGENES.RojoOp;
import SM.RRA.IMAGENES.TonoOp;
import SM.RRA.IU.Lienzo2D;
import SM.RRA.IU.LienzoAdapter;
import SM.RRA.IU.LienzoEvent;
import SM.RRA.IU.tipos;
import javax.swing.JFileChooser;
import java.awt.*;
import java.awt.color.ColorSpace;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.MouseMotionAdapter;
import java.awt.event.MouseMotionListener;
import java.awt.geom.AffineTransform;
import java.awt.geom.Line2D;
import java.awt.image.AffineTransformOp;
import java.awt.image.BandCombineOp;
import java.awt.image.BufferedImage;
import java.awt.image.ByteLookupTable;
import java.awt.image.ColorConvertOp;
import java.awt.image.ColorModel;
import java.awt.image.ComponentColorModel;
import java.awt.image.ConvolveOp;
import java.awt.image.DataBuffer;
import java.awt.image.Kernel;
import java.awt.image.LookupOp;
import java.awt.image.LookupTable;
import java.awt.image.RescaleOp;
import java.awt.image.WritableRaster;
import java.io.File;
import java.util.*;
import java.util.concurrent.TimeUnit;
import javax.imageio.ImageIO;
import javax.sound.sampled.LineEvent;
import javax.sound.sampled.LineListener;
import javax.swing.DefaultListModel;
import javax.swing.JColorChooser;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.event.InternalFrameAdapter;
import javax.swing.event.InternalFrameEvent;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.tools.JavaFileManager;
import sm.image.BufferedImageOpAdapter;
import sm.image.EqualizationOp;
import sm.image.KernelProducer;
import sm.image.LookupTableProducer;
import sm.image.SepiaOp;
import sm.image.TintOp;
import sm.sound.SMClipPlayer;
import sm.sound.SMSoundRecorder;
import uk.co.caprica.vlcj.discovery.NativeDiscovery;

/**
 *
 * @author raul
 */
public class VentanaPrincipal extends javax.swing.JFrame {

    private BufferedImage imgFuente = null;
    private SMClipPlayer player = null;
    private SMSoundRecorder recorder = null;
    /**
     * Booleanos para el control de la reproducción del sonido.
     */
    private boolean isPlaying = false;
    private boolean isPaused = false;

    /**
     * Creates new form VentanaPrincipal Titulo y tamaño personalizados
     */
    public VentanaPrincipal() {
        this.setTitle("APLICACIÓN MULTIMEDIA");
        this.setSize(2000, 2000);
        initComponents();
        listaLateral.setModel(new DefaultListModel());

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel4 = new javax.swing.JPanel();
        buttonGroup1 = new javax.swing.ButtonGroup();
        jLabel1 = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        barraEstado2 = new javax.swing.JLabel();
        jPanel3 = new javax.swing.JPanel();
        brillo = new javax.swing.JSlider();
        jLabel2 = new javax.swing.JLabel();
        Contraste = new javax.swing.JSlider();
        filtro = new javax.swing.JComboBox<>();
        jLabel3 = new javax.swing.JLabel();
        jSeparator2 = new javax.swing.JSeparator();
        contrasteBoton = new javax.swing.JButton();
        iluminada = new javax.swing.JButton();
        oscurecer = new javax.swing.JButton();
        slider2 = new javax.swing.JSlider();
        slider1 = new javax.swing.JSlider();
        jLabel4 = new javax.swing.JLabel();
        rotar = new javax.swing.JButton();
        aumento = new javax.swing.JButton();
        disminucion = new javax.swing.JButton();
        jLabel5 = new javax.swing.JLabel();
        cuadratica = new javax.swing.JButton();
        jLabel6 = new javax.swing.JLabel();
        cambioEspColor = new javax.swing.JComboBox<>();
        muestraBanda = new javax.swing.JButton();
        lineal = new javax.swing.JToggleButton();
        jPanel6 = new javax.swing.JPanel();
        combinar = new javax.swing.JButton();
        tintar = new javax.swing.JButton();
        sepia = new javax.swing.JButton();
        ecualizar = new javax.swing.JButton();
        recalcaRojos = new javax.swing.JButton();
        sliderVariaTono = new javax.swing.JSlider();
        sliderPosterizar = new javax.swing.JSlider();
        azulOp = new javax.swing.JButton();
        sliderGiro = new javax.swing.JSlider();
        negativo = new javax.swing.JButton();
        umbralizacionBinaria = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jPanel5 = new javax.swing.JPanel();
        jToolBar1 = new javax.swing.JToolBar();
        duplicar = new javax.swing.JButton();
        abrir = new javax.swing.JButton();
        nuevo = new javax.swing.JButton();
        guardar = new javax.swing.JButton();
        dibujoLibre = new javax.swing.JToggleButton();
        linea = new javax.swing.JToggleButton();
        cuadrado = new javax.swing.JToggleButton();
        elipse = new javax.swing.JToggleButton();
        curva = new javax.swing.JToggleButton();
        smile = new javax.swing.JToggleButton();
        seleccion = new javax.swing.JToggleButton();
        colores1 = new javax.swing.JPanel();
        negro1 = new javax.swing.JToggleButton();
        rojo1 = new javax.swing.JToggleButton();
        azul1 = new javax.swing.JToggleButton();
        amarillo1 = new javax.swing.JToggleButton();
        verde1 = new javax.swing.JToggleButton();
        masColores = new javax.swing.JToggleButton();
        relleno2 = new javax.swing.JToggleButton();
        transparencia = new javax.swing.JToggleButton();
        alisar = new javax.swing.JToggleButton();
        spinner = new javax.swing.JSpinner();
        spinnerDiscontnuidad = new javax.swing.JSpinner();
        colores2 = new javax.swing.JPanel();
        negro2 = new javax.swing.JToggleButton();
        rojo2 = new javax.swing.JToggleButton();
        azul2 = new javax.swing.JToggleButton();
        amarillo2 = new javax.swing.JToggleButton();
        verde2 = new javax.swing.JToggleButton();
        masColores1 = new javax.swing.JToggleButton();
        panelSonido = new javax.swing.JPanel();
        sonidos = new javax.swing.JComboBox<>();
        play = new javax.swing.JButton();
        stop = new javax.swing.JButton();
        pause = new javax.swing.JButton();
        grabar = new javax.swing.JButton();
        camara = new javax.swing.JButton();
        capturaInstantanea = new javax.swing.JButton();
        playVideo = new javax.swing.JButton();
        stopVideo = new javax.swing.JButton();
        jLabel7 = new javax.swing.JLabel();
        instantaneaVideo = new javax.swing.JButton();
        volcar = new javax.swing.JButton();
        panelDividido = new javax.swing.JSplitPane();
        escritorio = new javax.swing.JDesktopPane();
        jScrollPane1 = new javax.swing.JScrollPane();
        listaLateral = new javax.swing.JList<>();
        jMenuBar1 = new javax.swing.JMenuBar();
        Archivo = new javax.swing.JMenu();
        Nuevo = new javax.swing.JMenuItem();
        Abrir = new javax.swing.JMenuItem();
        Guardar = new javax.swing.JMenuItem();
        abrirSonido = new javax.swing.JMenuItem();
        jSeparator1 = new javax.swing.JPopupMenu.Separator();
        Salir = new javax.swing.JMenuItem();
        menuNuevo = new javax.swing.JMenuItem();
        Imagen = new javax.swing.JMenu();
        abreImagen = new javax.swing.JMenuItem();
        reescalado = new javax.swing.JMenuItem();
        convolucion = new javax.swing.JMenuItem();
        affineTransform = new javax.swing.JMenuItem();
        lookUpOp = new javax.swing.JMenuItem();
        BandCombineOp = new javax.swing.JMenuItem();
        colorConvertOp = new javax.swing.JMenuItem();
        Edicion = new javax.swing.JMenu();
        barraEstado = new javax.swing.JCheckBoxMenuItem();

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );

        jLabel1.setText("jLabel1");

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jPanel2.setLayout(new java.awt.BorderLayout());

        barraEstado2.setBackground(new java.awt.Color(153, 153, 153));
        barraEstado2.setText("Barra de Estado");
        jPanel2.add(barraEstado2, java.awt.BorderLayout.PAGE_END);

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        jPanel3.setPreferredSize(new java.awt.Dimension(800, 100));

        brillo.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        brillo.setToolTipText("Brillo");
        brillo.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                brilloStateChanged(evt);
            }
        });
        brillo.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                brilloFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                brilloFocusLost(evt);
            }
        });

        jLabel2.setText("Brillo Y Contraste");

        Contraste.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        Contraste.setToolTipText("Contraste");
        Contraste.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                ContrasteStateChanged(evt);
            }
        });
        Contraste.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                ContrasteFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                ContrasteFocusLost(evt);
            }
        });

        filtro.setToolTipText("Filtro");
        filtro.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Media", "Binomial", "Enfoque", "Relive", "Laplaciano", "Horizontal 5x1", "Medio 5x5", "Medio 7x7", "Horizontal 7x1", "Horizontal 10x1" }));
        filtro.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                filtroActionPerformed(evt);
            }
        });

        jLabel3.setText("Filtro");

        contrasteBoton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/contraste.png"))); // NOI18N
        contrasteBoton.setToolTipText("Contraste");
        contrasteBoton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                contrasteBotonActionPerformed(evt);
            }
        });

        iluminada.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/iluminar.png"))); // NOI18N
        iluminada.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                iluminadaActionPerformed(evt);
            }
        });

        oscurecer.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/oscurecer.png"))); // NOI18N
        oscurecer.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                oscurecerActionPerformed(evt);
            }
        });

        slider2.setMaximum(255);
        slider2.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                slider2StateChanged(evt);
            }
        });
        slider2.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                slider2FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                slider2FocusLost(evt);
            }
        });

        slider1.setMaximum(255);
        slider1.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                slider1StateChanged(evt);
            }
        });
        slider1.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                slider1FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                slider1FocusLost(evt);
            }
        });

        jLabel4.setText("Transformaciones");

        rotar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/rotacion180.png"))); // NOI18N
        rotar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rotarActionPerformed(evt);
            }
        });

        aumento.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/aumentar.png"))); // NOI18N
        aumento.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                aumentoActionPerformed(evt);
            }
        });

        disminucion.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/disminuir.png"))); // NOI18N
        disminucion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                disminucionActionPerformed(evt);
            }
        });

        jLabel5.setText("Rotación Y escalado");

        cuadratica.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/cuadratica.png"))); // NOI18N
        cuadratica.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cuadraticaActionPerformed(evt);
            }
        });

        jLabel6.setText("Color");

        cambioEspColor.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "sRGB", "YCC", "GREY" }));
        cambioEspColor.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cambioEspColorActionPerformed(evt);
            }
        });

        muestraBanda.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/bandas.png"))); // NOI18N
        muestraBanda.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                muestraBandaActionPerformed(evt);
            }
        });

        lineal.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/lineal.png"))); // NOI18N
        lineal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                linealActionPerformed(evt);
            }
        });

        jPanel6.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        jPanel6.setPreferredSize(new java.awt.Dimension(220, 59));

        combinar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/combinar.png"))); // NOI18N
        combinar.setPreferredSize(new java.awt.Dimension(20, 20));
        combinar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                combinarActionPerformed(evt);
            }
        });

        tintar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/tintar.png"))); // NOI18N
        tintar.setPreferredSize(new java.awt.Dimension(20, 20));
        tintar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                tintarActionPerformed(evt);
            }
        });

        sepia.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/sepia.png"))); // NOI18N
        sepia.setPreferredSize(new java.awt.Dimension(20, 20));
        sepia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                sepiaActionPerformed(evt);
            }
        });

        ecualizar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/ecualizar.png"))); // NOI18N
        ecualizar.setPreferredSize(new java.awt.Dimension(20, 20));
        ecualizar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ecualizarActionPerformed(evt);
            }
        });

        recalcaRojos.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/rojo.png"))); // NOI18N
        recalcaRojos.setPreferredSize(new java.awt.Dimension(20, 20));
        recalcaRojos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                recalcaRojosActionPerformed(evt);
            }
        });

        sliderVariaTono.setMaximum(359);
        sliderVariaTono.setValue(180);
        sliderVariaTono.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                sliderVariaTonoStateChanged(evt);
            }
        });
        sliderVariaTono.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                sliderVariaTonoFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                sliderVariaTonoFocusLost(evt);
            }
        });

        sliderPosterizar.setMaximum(20);
        sliderPosterizar.setMinimum(2);
        sliderPosterizar.setValue(10);
        sliderPosterizar.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                sliderPosterizarStateChanged(evt);
            }
        });
        sliderPosterizar.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                sliderPosterizarFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                sliderPosterizarFocusLost(evt);
            }
        });

        azulOp.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/azul.jpg"))); // NOI18N
        azulOp.setToolTipText("recalca azul");
        azulOp.setMaximumSize(new java.awt.Dimension(20, 20));
        azulOp.setMinimumSize(new java.awt.Dimension(20, 20));
        azulOp.setPreferredSize(new java.awt.Dimension(20, 20));
        azulOp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                azulOpActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addComponent(combinar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(tintar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(sepia, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(ecualizar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(12, 12, 12)
                .addComponent(azulOp, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(recalcaRojos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(sliderVariaTono, javax.swing.GroupLayout.PREFERRED_SIZE, 74, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(sliderPosterizar, javax.swing.GroupLayout.PREFERRED_SIZE, 56, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(17, 17, 17))
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(combinar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(tintar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(sepia, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(ecualizar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(recalcaRojos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(sliderVariaTono, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(sliderPosterizar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(azulOp, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(21, Short.MAX_VALUE))
        );

        sliderGiro.setMajorTickSpacing(90);
        sliderGiro.setMaximum(360);
        sliderGiro.setMinorTickSpacing(10);
        sliderGiro.setValue(0);
        sliderGiro.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                sliderGiroStateChanged(evt);
            }
        });
        sliderGiro.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                sliderGiroFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                sliderGiroFocusLost(evt);
            }
        });

        negativo.setText("-");
        negativo.setToolTipText("Negativo");
        negativo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                negativoActionPerformed(evt);
            }
        });

        umbralizacionBinaria.setToolTipText("Umbralización binaria");
        umbralizacionBinaria.setText("0/1");
        umbralizacionBinaria.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                umbralizacionBinariaActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addGap(25, 25, 25)
                        .addComponent(jLabel3)
                        .addGap(42, 42, 42)
                        .addComponent(jLabel4))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addComponent(brillo, javax.swing.GroupLayout.PREFERRED_SIZE, 63, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(Contraste, javax.swing.GroupLayout.PREFERRED_SIZE, 58, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(filtro, javax.swing.GroupLayout.PREFERRED_SIZE, 64, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(9, 9, 9)
                        .addComponent(negativo)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(contrasteBoton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(iluminada)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(oscurecer)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cuadratica)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lineal, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 9, Short.MAX_VALUE)
                        .addComponent(umbralizacionBinaria, javax.swing.GroupLayout.PREFERRED_SIZE, 66, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(12, 12, 12)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(slider1, javax.swing.GroupLayout.PREFERRED_SIZE, 74, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(6, 6, 6)
                        .addComponent(slider2, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel3Layout.createSequentialGroup()
                            .addComponent(rotar)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                            .addComponent(aumento)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(disminucion)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(muestraBanda)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(cambioEspColor, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(jPanel3Layout.createSequentialGroup()
                            .addComponent(jLabel5, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                            .addComponent(jLabel6)
                            .addGap(90, 90, 90)))
                    .addComponent(sliderGiro, javax.swing.GroupLayout.PREFERRED_SIZE, 96, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, 332, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(81, 81, 81)
                .addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 13, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(105, Short.MAX_VALUE))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 18, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jLabel3))
                                    .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.TRAILING))
                                .addComponent(jLabel5, javax.swing.GroupLayout.Alignment.TRAILING))
                            .addComponent(jLabel6, javax.swing.GroupLayout.Alignment.TRAILING))
                        .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel3Layout.createSequentialGroup()
                                .addGap(18, 18, 18)
                                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(jPanel3Layout.createSequentialGroup()
                                        .addGap(9, 9, 9)
                                        .addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addComponent(oscurecer)
                                    .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                        .addComponent(slider2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(lineal)
                                        .addComponent(cuadratica))
                                    .addComponent(iluminada)
                                    .addComponent(contrasteBoton)
                                    .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(Contraste, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(brillo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(filtro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(negativo))
                                    .addComponent(umbralizacionBinaria)))
                            .addGroup(jPanel3Layout.createSequentialGroup()
                                .addGap(6, 6, 6)
                                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(slider1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                        .addComponent(disminucion, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(aumento, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(rotar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(muestraBanda, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                                    .addComponent(cambioEspColor, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(sliderGiro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel2.add(jPanel3, java.awt.BorderLayout.PAGE_START);

        getContentPane().add(jPanel2, java.awt.BorderLayout.PAGE_END);

        jPanel1.setMaximumSize(new java.awt.Dimension(31, 31));
        jPanel1.setMinimumSize(new java.awt.Dimension(29, 29));
        jPanel1.setPreferredSize(new java.awt.Dimension(30, 30));
        jPanel1.setLayout(new java.awt.GridLayout(1, 0));

        jPanel5.setLayout(new java.awt.GridLayout(1, 0));

        jToolBar1.setBackground(new java.awt.Color(153, 153, 153));
        jToolBar1.setRollover(true);

        duplicar.setText("Duplicar");
        duplicar.setFocusable(false);
        duplicar.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        duplicar.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        duplicar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                duplicarActionPerformed(evt);
            }
        });
        jToolBar1.add(duplicar);

        abrir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/abrir.png"))); // NOI18N
        abrir.setFocusable(false);
        abrir.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        abrir.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        abrir.setToolTipText("Abre un archivo de audio, video o una imagen");
        abrir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                abrirActionPerformed(evt);
            }
        });
        jToolBar1.add(abrir);

        nuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/nuevo.png"))); // NOI18N
        nuevo.setToolTipText("Nuevo lienzo en blanco");
        nuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                nuevoActionPerformed(evt);
            }
        });
        jToolBar1.add(nuevo);

        guardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/guardar.png"))); // NOI18N
        guardar.setToolTipText("Guardar");
        guardar.setFocusable(false);
        guardar.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        guardar.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        guardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                guardarActionPerformed(evt);
            }
        });
        jToolBar1.add(guardar);

        buttonGroup1.add(dibujoLibre);
        dibujoLibre.setToolTipText("Dibujo Libre");
        dibujoLibre.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/trazo.png"))); // NOI18N
        dibujoLibre.setFocusable(false);
        dibujoLibre.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        dibujoLibre.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        dibujoLibre.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dibujoLibreActionPerformed(evt);
            }
        });
        jToolBar1.add(dibujoLibre);

        buttonGroup1.add(linea);
        linea.setToolTipText("Linea");
        linea.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/linea.png"))); // NOI18N
        linea.setFocusable(false);
        linea.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        linea.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        linea.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                lineaActionPerformed(evt);
            }
        });
        jToolBar1.add(linea);

        buttonGroup1.add(cuadrado);
        cuadrado.setToolTipText("Cuadrado");
        cuadrado.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/rectangulo.png"))); // NOI18N
        cuadrado.setFocusable(false);
        cuadrado.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        cuadrado.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        cuadrado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cuadradoActionPerformed(evt);
            }
        });
        jToolBar1.add(cuadrado);

        buttonGroup1.add(elipse);
        elipse.setToolTipText("Elipse");
        elipse.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/elipse.png"))); // NOI18N
        elipse.setFocusable(false);
        elipse.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        elipse.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        elipse.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                elipseActionPerformed(evt);
            }
        });
        jToolBar1.add(elipse);

        buttonGroup1.add(curva);
        curva.setToolTipText("Curva");
        curva.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/curva.png"))); // NOI18N
        curva.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        curva.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        curva.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                curvaActionPerformed(evt);
            }
        });
        jToolBar1.add(curva);

        buttonGroup1.add(smile);
        smile.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/smile.png"))); // NOI18N
        smile.setToolTipText("smile");
        smile.setFocusable(false);
        smile.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        smile.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        smile.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                smileActionPerformed(evt);
            }
        });
        jToolBar1.add(smile);

        seleccion.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/seleccion.png"))); // NOI18N
        seleccion.setFocusable(false);
        seleccion.setToolTipText("mover");
        seleccion.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        seleccion.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        seleccion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                seleccionActionPerformed(evt);
            }
        });
        jToolBar1.add(seleccion);

        colores1.setPreferredSize(new java.awt.Dimension(35, 25));
        colores1.setToolTipText("Paleta de colores para dibujar");
        colores1.setLayout(new java.awt.GridLayout(2, 3));

        negro1.setBackground(new java.awt.Color(0, 0, 0));
        negro1.setPreferredSize(new java.awt.Dimension(25, 25));
        negro1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                negro1ActionPerformed(evt);
            }
        });
        colores1.add(negro1);

        rojo1.setBackground(new java.awt.Color(255, 0, 0));
        rojo1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rojo1ActionPerformed(evt);
            }
        });
        colores1.add(rojo1);

        azul1.setBackground(new java.awt.Color(0, 0, 204));
        azul1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                azul1ActionPerformed(evt);
            }
        });
        colores1.add(azul1);

        amarillo1.setBackground(new java.awt.Color(255, 255, 51));
        amarillo1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                amarillo1ActionPerformed(evt);
            }
        });
        colores1.add(amarillo1);

        verde1.setBackground(new java.awt.Color(51, 255, 51));
        verde1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                verde1ActionPerformed(evt);
            }
        });
        colores1.add(verde1);

        masColores.setText("+");
        masColores.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                masColoresActionPerformed(evt);
            }
        });
        colores1.add(masColores);

        jToolBar1.add(colores1);

        relleno2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/rellenar.png"))); // NOI18N
        relleno2.setFocusable(false);
        relleno2.setToolTipText("Rellenar");
        relleno2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        relleno2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        relleno2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                relleno2ActionPerformed(evt);
            }
        });
        jToolBar1.add(relleno2);

        transparencia.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/transparencia.png"))); // NOI18N
        transparencia.setToolTipText("Transparente");
        transparencia.setFocusable(false);
        transparencia.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        transparencia.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        transparencia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                transparenciaActionPerformed(evt);
            }
        });
        jToolBar1.add(transparencia);

        alisar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/alisar.png"))); // NOI18N
        alisar.setToolTipText("Alisado");
        alisar.setFocusable(false);
        alisar.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        alisar.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        alisar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                alisarActionPerformed(evt);
            }
        });
        jToolBar1.add(alisar);

        spinner.setMinimumSize(new java.awt.Dimension(24, 24));
        spinner.setPreferredSize(new java.awt.Dimension(44, 24));
        spinner.setToolTipText("Nivel de grosor");
        spinner.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                spinnerStateChanged(evt);
            }
        });
        jToolBar1.add(spinner);

        spinnerDiscontnuidad.setToolTipText("Nivel de discontinuidad");
        spinnerDiscontnuidad.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                spinnerDiscontnuidadStateChanged(evt);
            }
        });
        jToolBar1.add(spinnerDiscontnuidad);

        colores2.setPreferredSize(new java.awt.Dimension(35, 25));
        colores2.setLayout(new java.awt.GridLayout(2, 3));

        negro2.setBackground(new java.awt.Color(0, 0, 0));
        negro2.setPreferredSize(new java.awt.Dimension(25, 25));
        negro2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                negro2ActionPerformed(evt);
            }
        });
        colores2.add(negro2);

        rojo2.setBackground(new java.awt.Color(255, 0, 0));
        rojo2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rojo2ActionPerformed(evt);
            }
        });
        colores2.add(rojo2);

        azul2.setBackground(new java.awt.Color(0, 0, 204));
        azul2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                azul2ActionPerformed(evt);
            }
        });
        colores2.add(azul2);

        amarillo2.setBackground(new java.awt.Color(255, 255, 51));
        amarillo2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                amarillo2ActionPerformed(evt);
            }
        });
        colores2.add(amarillo2);

        verde2.setBackground(new java.awt.Color(51, 255, 51));
        verde2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                verde2ActionPerformed(evt);
            }
        });
        colores2.add(verde2);

        masColores1.setText("+");
        masColores1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                masColores1ActionPerformed(evt);
            }
        });
        colores2.add(masColores1);

        jToolBar1.add(colores2);

        panelSonido.setBackground(new java.awt.Color(0, 255, 0));

        sonidos.setPreferredSize(new java.awt.Dimension(72, 20));

        play.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/play24x24.png"))); // NOI18N
        play.setPreferredSize(new java.awt.Dimension(20, 20));
        play.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                playActionPerformed(evt);
            }
        });

        stop.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/stop24x24.png"))); // NOI18N
        stop.setToolTipText("Stop");
        stop.setPreferredSize(new java.awt.Dimension(20, 20));
        stop.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                stopActionPerformed(evt);
            }
        });

        pause.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/pausa24x24.png"))); // NOI18N
        pause.setPreferredSize(new java.awt.Dimension(20, 20));
        pause.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                pauseActionPerformed(evt);
            }
        });

        grabar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/record24x24.png"))); // NOI18N
        grabar.setPreferredSize(new java.awt.Dimension(20, 20));
        grabar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                grabarActionPerformed(evt);
            }
        });

        camara.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/Camara.png"))); // NOI18N
        camara.setPreferredSize(new java.awt.Dimension(20, 20));
        camara.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                camaraActionPerformed(evt);
            }
        });

        capturaInstantanea.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/Capturar.png"))); // NOI18N
        capturaInstantanea.setPreferredSize(new java.awt.Dimension(20, 20));
        capturaInstantanea.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                capturaInstantaneaActionPerformed(evt);
            }
        });

        playVideo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/Play.png"))); // NOI18N
        playVideo.setPreferredSize(new java.awt.Dimension(20, 20));
        playVideo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                playVideoActionPerformed(evt);
            }
        });

        stopVideo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/Stop.png"))); // NOI18N
        stopVideo.setPreferredSize(new java.awt.Dimension(20, 21));
        stopVideo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                stopVideoActionPerformed(evt);
            }
        });

        jLabel7.setForeground(new java.awt.Color(0, 51, 255));
        jLabel7.setText("PANEL MULTIMEDIA --->");

        instantaneaVideo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/Capturar.png"))); // NOI18N
        instantaneaVideo.setPreferredSize(new java.awt.Dimension(20, 20));
        instantaneaVideo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                instantaneaVideoActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout panelSonidoLayout = new javax.swing.GroupLayout(panelSonido);
        panelSonido.setLayout(panelSonidoLayout);
        panelSonidoLayout.setHorizontalGroup(
            panelSonidoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelSonidoLayout.createSequentialGroup()
                .addGap(17, 17, 17)
                .addComponent(jLabel7)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(play, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(stop, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pause, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(grabar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(sonidos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(41, 41, 41)
                .addComponent(camara, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(capturaInstantanea, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(33, 33, 33)
                .addComponent(playVideo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(stopVideo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(instantaneaVideo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(50, 50, 50))
        );
        panelSonidoLayout.setVerticalGroup(
            panelSonidoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelSonidoLayout.createSequentialGroup()
                .addGroup(panelSonidoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(panelSonidoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                        .addComponent(play, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGroup(panelSonidoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(pause, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(sonidos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(stop, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, panelSonidoLayout.createSequentialGroup()
                                .addGap(4, 4, 4)
                                .addComponent(jLabel7))))
                    .addComponent(grabar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(playVideo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(panelSonidoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                        .addComponent(stopVideo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(instantaneaVideo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(capturaInstantanea, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(camara, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jToolBar1.add(panelSonido);

        volcar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ICONOS/volcar.png"))); // NOI18N
        volcar.setToolTipText("Volcar trazos");
        volcar.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        volcar.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        volcar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                volcarActionPerformed(evt);
            }
        });
        jToolBar1.add(volcar);

        jPanel5.add(jToolBar1);

        jPanel1.add(jPanel5);

        getContentPane().add(jPanel1, java.awt.BorderLayout.PAGE_START);

        panelDividido.setDividerLocation(1050);

        escritorio.setPreferredSize(new java.awt.Dimension(1050, 651));

        javax.swing.GroupLayout escritorioLayout = new javax.swing.GroupLayout(escritorio);
        escritorio.setLayout(escritorioLayout);
        escritorioLayout.setHorizontalGroup(
            escritorioLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 1050, Short.MAX_VALUE)
        );
        escritorioLayout.setVerticalGroup(
            escritorioLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 651, Short.MAX_VALUE)
        );

        panelDividido.setLeftComponent(escritorio);

        jScrollPane1.setViewportView(listaLateral);

        panelDividido.setRightComponent(jScrollPane1);

        getContentPane().add(panelDividido, java.awt.BorderLayout.CENTER);

        jMenuBar1.setBackground(new java.awt.Color(0, 0, 0));
        jMenuBar1.setForeground(new java.awt.Color(0, 0, 0));

        Archivo.setText("Archivo");

        Nuevo.setText("Nuevo");
        Nuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                NuevoActionPerformed(evt);
            }
        });
        Archivo.add(Nuevo);

        Abrir.setText("Abrir");
        Abrir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                AbrirActionPerformed(evt);
            }
        });
        Archivo.add(Abrir);

        Guardar.setText("Guardar");
        Guardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                GuardarActionPerformed(evt);
            }
        });
        Archivo.add(Guardar);

        abrirSonido.setText("Abrir Sonido");
        abrirSonido.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                abrirSonidoActionPerformed(evt);
            }
        });
        Archivo.add(abrirSonido);
        Archivo.add(jSeparator1);

        Salir.setText("Salir");
        Salir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                SalirActionPerformed(evt);
            }
        });
        Archivo.add(Salir);

        menuNuevo.setText("Nuevo Lienzo");
        menuNuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                menuNuevoActionPerformed(evt);
            }
        });
        Archivo.add(menuNuevo);

        jMenuBar1.add(Archivo);

        Imagen.setText("Imagen");

        abreImagen.setText("Abrir imagen");
        abreImagen.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                abreImagenActionPerformed(evt);
            }
        });
        Imagen.add(abreImagen);

        reescalado.setText("Reescalado");
        reescalado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                reescaladoActionPerformed(evt);
            }
        });
        Imagen.add(reescalado);

        convolucion.setText("Convolución");
        convolucion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                convolucionActionPerformed(evt);
            }
        });
        Imagen.add(convolucion);

        affineTransform.setText("AffineTransform");
        affineTransform.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                affineTransformActionPerformed(evt);
            }
        });
        Imagen.add(affineTransform);

        lookUpOp.setText("LookUpOp");
        lookUpOp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                lookUpOpActionPerformed(evt);
            }
        });
        Imagen.add(lookUpOp);

        BandCombineOp.setText("BandCombineOp");
        BandCombineOp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BandCombineOpActionPerformed(evt);
            }
        });
        Imagen.add(BandCombineOp);

        colorConvertOp.setText("ColorConvertOp");
        colorConvertOp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                colorConvertOpActionPerformed(evt);
            }
        });
        Imagen.add(colorConvertOp);

        jMenuBar1.add(Imagen);

        Edicion.setText("Edicion");

        barraEstado.setSelected(true);
        barraEstado.setText("Ver barra de estado");
        barraEstado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                barraEstadoActionPerformed(evt);
            }
        });
        Edicion.add(barraEstado);

        jMenuBar1.add(Edicion);

        setJMenuBar(jMenuBar1);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void barraEstadoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_barraEstadoActionPerformed
        this.barraEstado2.setVisible(barraEstado.isSelected());
    }//GEN-LAST:event_barraEstadoActionPerformed

    public JLabel getBarraEstado2() {
        return barraEstado2;
    }

    public void setBarraEstado2(JLabel barraEstado2) {
        this.barraEstado2 = barraEstado2;
    }

    /**
     * Método de evento que se dispara cuando se selecciona la opción "Abrir".
     * Abre un cuadro de diálogo de selección de archivo, lee el archivo
     * seleccionado y realiza acciones según el tipo de archivo.
     *
     * @param evt ABRIR
     */
    private void AbrirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_AbrirActionPerformed
        JFileChooser dlg = new JFileChooser();
        int resp = dlg.showOpenDialog(this);
        if (resp == JFileChooser.APPROVE_OPTION) {

            if (getFileExtension(dlg.getSelectedFile()).contentEquals(".jpg") || getFileExtension(dlg.getSelectedFile()).contentEquals(".png")) {
                try {
                    File f = dlg.getSelectedFile();
                    BufferedImage img = ImageIO.read(f);
                    VentanaInternaImagen vi = new VentanaInternaImagen();
                    vi.getLienzo2D().setImagen(img);
                    vi.setTitle(f.getName());
                    this.escritorio.add(vi);
                    vi.setVisible(true);
                    vi.getLienzo2D().addLienzoListener(new ManejadorLienzo());
                    vi.addInternalFrameListener(new ManejadorVentanaInterna());
                } catch (Exception ex) {
                    System.err.println("Error al leer la imagen");
                }
            }
            if (getFileExtension(dlg.getSelectedFile()).contentEquals(".wav") || getFileExtension(dlg.getSelectedFile()).contentEquals(".au")) {
                try {
                    //Solucion usando clase anónima
                    File f = new File(dlg.getSelectedFile().getAbsolutePath()) {
                        @Override
                        public String toString() {
                            return this.getName();
                        }
                    };
                    this.sonidos.addItem(f);
                    this.sonidos.setSelectedItem(f);
                } catch (Exception ex) {
                    System.err.print("Error al abrir el sonido");
                }
            }

            if (getFileExtension(dlg.getSelectedFile()).contentEquals(".mp4") || getFileExtension(dlg.getSelectedFile()).contentEquals(".avi")) {
                try {
                    File f = dlg.getSelectedFile();
                    VentanaInternaVideo vv = VentanaInternaVideo.getInstance(f);
                    escritorio.add(vv);
                    vv.setVisible(true);

                } catch (Exception ex) {
                    System.err.print("Error al abrir el video");
                }
            }

        }
    }//GEN-LAST:event_AbrirActionPerformed

    /**
     * Cierra la aplicación.
     */
    private void SalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_SalirActionPerformed
        System.exit(0);
    }//GEN-LAST:event_SalirActionPerformed

    /**
     * @brief Pulsando nuevo borramos todos los dibujos. Invoca el método
     * nuevoLienzo de la clase lienzo que se encarga de "borrar".
     */
    private void NuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_NuevoActionPerformed
        this.getLienzoSeleccionado().nuevoLienzo();
        Nuevo.setToolTipText("nuevo");
    }//GEN-LAST:event_NuevoActionPerformed

    private void elipseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_elipseActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setTipo(tipos.ELIPSE);
            barraEstado2.setText("Elipse");
        }
    }//GEN-LAST:event_elipseActionPerformed

    private void lineaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_lineaActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setTipo(tipos.LINEA);
            barraEstado2.setText("Línea");
        }
    }//GEN-LAST:event_lineaActionPerformed

    private void cuadradoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cuadradoActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setTipo(tipos.RECTANGULO);
            barraEstado2.setText("Rectángulo");
        }
    }//GEN-LAST:event_cuadradoActionPerformed
//*******************************************************************************//

    /**
     * Método de evento que se dispara cuando se selecciona la opción "Guardar".
     * Guarda la imagen de la ventana interna actual en un archivo seleccionado
     * por el usuario.
     *
     * @param evt
     */
    private void GuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_GuardarActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) escritorio.getSelectedFrame();
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen(true);
            if (img != null) {
                JFileChooser dlg = new JFileChooser();
                int resp = dlg.showSaveDialog(this);
                if (resp == JFileChooser.APPROVE_OPTION) {
                    try {
                        File f = dlg.getSelectedFile();
                        ImageIO.write(img, "jpg", f);
                        vi.setTitle(f.getName());
                    } catch (Exception ex) {
                        System.err.println("Error al guardar la imagen");
                    }
                }
            }
        }
    }//GEN-LAST:event_GuardarActionPerformed

    /**
     * Método de evento que se dispara cuando se selecciona la opción "Nuevo" en
     * el menú. Crea una nueva ventana interna y establece una imagen en blanco
     * en el lienzo.
     *
     * @param evt
     */
    private void menuNuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_menuNuevoActionPerformed
        VentanaInternaImagen vi = new VentanaInternaImagen();
        escritorio.add(vi);
        vi.setVisible(true);
        BufferedImage img = new BufferedImage(300, 300, BufferedImage.TYPE_INT_ARGB);
        vi.getLienzo2D().setImagen(img);
    }//GEN-LAST:event_menuNuevoActionPerformed

    //Colores de los trazos

    private void negro1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_negro1ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColor(Color.black);
        }
    }//GEN-LAST:event_negro1ActionPerformed

    private void rojo1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rojo1ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColor(Color.red);
        }
    }//GEN-LAST:event_rojo1ActionPerformed

    private void azul1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_azul1ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColor(Color.blue);
        }
    }//GEN-LAST:event_azul1ActionPerformed

    private void amarillo1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_amarillo1ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColor(Color.yellow);
        }
    }//GEN-LAST:event_amarillo1ActionPerformed

    private void verde1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_verde1ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColor(Color.green);
        }
    }//GEN-LAST:event_verde1ActionPerformed

    private void seleccionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_seleccionActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setMover(seleccion.isSelected());
        }
       }//GEN-LAST:event_seleccionActionPerformed

    private void masColoresActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_masColoresActionPerformed
        if (hayLienzo()) {
            Color color = JColorChooser.showDialog(this, "Elija un color", Color.red);
            this.getLienzoSeleccionado().setColor(color);
        }
    }//GEN-LAST:event_masColoresActionPerformed

    private void curvaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_curvaActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setTipo(tipos.CURVA);
        }
        barraEstado2.setText("Curva");
        curva.setToolTipText("curva");
    }//GEN-LAST:event_curvaActionPerformed

    /**
     * @brief Creamos una ventana interna que se añade a nuestro escritorio y
     * creamos una imagen vacía en blanco.
     * @param evt el evento
     */
    private void nuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nuevoActionPerformed
        VentanaInternaImagen vi = new VentanaInternaImagen();
        vi.setTitle("Nueva");
        vi.getLienzo2D().addLienzoListener(new ManejadorLienzo());
        vi.addInternalFrameListener(new ManejadorVentanaInterna());
        escritorio.add(vi);
        vi.setVisible(true);

        String inputWidth = JOptionPane.showInputDialog("Introduce el ancho de la imagen:");
        String inputHeight = JOptionPane.showInputDialog("Introduce la altura de la imagen:");

        // Comprueba si el usuario ha pulsado cancelar
        if (inputWidth == null || inputHeight == null) {
            return; // salir del método
        }

        // Comprueba si los valores introducidos son números
        int width, height;
        try {
            width = Integer.parseInt(inputWidth);
            height = Integer.parseInt(inputHeight);
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(null, "Por favor, introduce números válidos para el ancho y la altura.");
            return; // salir del método
        }

        BufferedImage img = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2d = img.createGraphics();
        g2d.setColor(Color.WHITE);
        g2d.fillRect(0, 0, img.getWidth(), img.getHeight());
        vi.getLienzo2D().setImagen(img);
    }//GEN-LAST:event_nuevoActionPerformed

    /**
     * El método abrirActionPerformed se dispara cuando se selecciona la opción
     * "Abrir" y permite al usuario seleccionar un archivo de imagen, sonido o
     * video. Según el tipo de archivo seleccionado, se realiza una acción
     * correspondiente. Si es un archivo de imagen, se lee y se muestra en una
     * nueva ventana interna de imagen. Si es un archivo de sonido, se agrega a
     * un componente de lista desplegable. Si es un archivo de video, se crea
     * una nueva ventana interna de video y se muestra en el escritorio. El
     * método gestiona la apertura de diferentes tipos de archivos y realiza
     * acciones adecuadas en función de cada tipo.
     *
     * @param evt
     */
    private void abrirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_abrirActionPerformed
        JFileChooser dlg = new JFileChooser();
        // Configurar los filtros de archivos
        FileNameExtensionFilter filterImagenes = new FileNameExtensionFilter(
                "Imágenes", "jpg", "png");
        FileNameExtensionFilter filterSonidos = new FileNameExtensionFilter(
                "Sonidos", "wav", "au");
        FileNameExtensionFilter filterVideos = new FileNameExtensionFilter(
                "Videos", "mp4", "avi", "mpg");

        dlg.addChoosableFileFilter(filterImagenes);
        dlg.addChoosableFileFilter(filterSonidos);
        dlg.addChoosableFileFilter(filterVideos);
        dlg.setFileFilter(dlg.getAcceptAllFileFilter());
        int resp = dlg.showOpenDialog(this);
        if (resp == JFileChooser.APPROVE_OPTION) {

            if (getFileExtension(dlg.getSelectedFile()).contentEquals(".jpg") || getFileExtension(dlg.getSelectedFile()).contentEquals(".png")) {
                try {
                    File f = dlg.getSelectedFile();
                    BufferedImage img = ImageIO.read(f);
                    // Redimensionar la imagen si es necesario
                    /*if (img.getWidth() > 426 || img.getHeight() > 240) {
                        int newWidth;
                        int newHeight;
                        // mantener la proporción de aspecto
                        if (img.getWidth() >= img.getHeight()) {
                            newWidth = 426;
                            newHeight = (int) (img.getHeight() * ((double) 426 / img.getWidth()));
                        } else {
                            newHeight = 240;
                            newWidth = (int) (img.getWidth() * ((double) 240 / img.getHeight()));
                        }
                        Image scaledImage = img.getScaledInstance(newWidth, newHeight, Image.SCALE_SMOOTH);
                        img = new BufferedImage(newWidth, newHeight, BufferedImage.TYPE_INT_ARGB);
                        Graphics2D g2d = img.createGraphics();
                        g2d.drawImage(scaledImage, 0, 0, null);
                        g2d.dispose();
                    }*/
                    VentanaInternaImagen vi = new VentanaInternaImagen();
                    vi.getLienzo2D().setImagen(img);
                    vi.setTitle(f.getName()); // Agregar esta línea para establecer el título de la ventana interna
                    this.escritorio.add(vi);
                    vi.setVisible(true);
                    vi.getLienzo2D().addLienzoListener(new ManejadorLienzo());
                    vi.addInternalFrameListener(new ManejadorVentanaInterna());
                } catch (Exception ex) {
                    System.err.println("Error al leer la imagen");
                }
            }
            if (getFileExtension(dlg.getSelectedFile()).contentEquals(".wav") || getFileExtension(dlg.getSelectedFile()).contentEquals(".au")) {
                try {
                    //Solucion usando clase anónima
                    File f = new File(dlg.getSelectedFile().getAbsolutePath()) {
                        @Override
                        public String toString() {
                            return this.getName();
                        }
                    };
                    this.sonidos.addItem(f);
                    this.sonidos.setSelectedItem(f);
                } catch (Exception ex) {
                    System.err.print("Error al abrir el sonido");
                }
            }

            if (getFileExtension(dlg.getSelectedFile()).contentEquals(".mp4") || getFileExtension(dlg.getSelectedFile()).contentEquals(".avi") || getFileExtension(dlg.getSelectedFile()).contentEquals(".mpg")) {
                try {
                    File f = dlg.getSelectedFile();
                    VentanaInternaVideo vv = VentanaInternaVideo.getInstance(f);
                    escritorio.add(vv);
                    vv.setVisible(true);
                    vv.setTitle(f.getName());

                } catch (Exception ex) {
                    System.err.print("Error al abrir el video");
                }
            }

        }
    }//GEN-LAST:event_abrirActionPerformed

    /**
     * Guardar una imagen.
     *
     * @param evt
     */
    private void guardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_guardarActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) escritorio.getSelectedFrame();
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen(true);
            if (img != null) {
                JFileChooser dlg = new JFileChooser();
                int resp = dlg.showSaveDialog(this);
                if (resp == JFileChooser.APPROVE_OPTION) {
                    try {
                        File f = dlg.getSelectedFile();
                        ImageIO.write(img, "png", f);
                        vi.setTitle(f.getName());
                    } catch (Exception ex) {
                        System.err.println("Error al guardar la imagen");
                    }
                }
            }
        }
    }//GEN-LAST:event_guardarActionPerformed

    private void smileActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_smileActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setTipo(tipos.SMILE);
        }
        barraEstado2.setText("Smile");
    }//GEN-LAST:event_smileActionPerformed

    /**
     * Abrir una imagen
     *
     * @param evt
     */
    private void abreImagenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_abreImagenActionPerformed
        JFileChooser dlg = new JFileChooser();
        int resp = dlg.showOpenDialog(this);
        if (resp == JFileChooser.APPROVE_OPTION) {
            try {
                File f = dlg.getSelectedFile();
                BufferedImage img = ImageIO.read(f);
                VentanaInternaImagen vi = new VentanaInternaImagen();
                vi.getLienzo2D().setImagen(img);
                this.escritorio.add(vi);
                vi.setTitle(f.getName());
                vi.setVisible(true);
            } catch (Exception ex) {
                System.err.println("Error al leer la imagen");
            }
        }
    }//GEN-LAST:event_abreImagenActionPerformed

    private void dibujoLibreActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dibujoLibreActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setTipo(tipos.LIBRE);
        }
        barraEstado2.setText("Trazo libre");
    }//GEN-LAST:event_dibujoLibreActionPerformed

    private void transparenciaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_transparenciaActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setTransparente(transparencia.isSelected());
        }
    }//GEN-LAST:event_transparenciaActionPerformed

    /**
     * Spinner encargado de establecer el grosor.
     *
     * @param evt
     */
    private void spinnerStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_spinnerStateChanged
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setGrosor(Integer.parseInt(spinner.getValue().toString()));
        }
    }//GEN-LAST:event_spinnerStateChanged

    private void alisarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_alisarActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setLiso(alisar.isSelected());
        }
    }//GEN-LAST:event_alisarActionPerformed

    /**
     * Este método se activa cuando se selecciona la opción "Reescalado".
     * Obtiene la ventana interna de imagen seleccionada del escritorio. Si la
     * ventana interna existe y tiene una imagen válida, aplica un efecto de
     * reescalado utilizando la clase RescaleOp. Luego, repinta el lienzo de la
     * ventana interna.
     *
     * @param evt
     */
    private void reescaladoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_reescaladoActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    RescaleOp rop = new RescaleOp(1.0F, 100.0F, null);
                    rop.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_reescaladoActionPerformed

    /**
     * Este método se dispara cuando se selecciona la opción "Convolución".
     * Obtiene la ventana interna de imagen seleccionada del escritorio. Si la
     * ventana interna existe y tiene una imagen válida, aplica un efecto de
     * convolución utilizando la clase ConvolveOp. Se utiliza un kernel
     * predefinido según la selección del usuario en un componente de lista
     * desplegable. Luego, establece la imagen resultante en el lienzo de la
     * ventana interna y repinta el lienzo.
     *
     * @param evt
     */
    private void convolucionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_convolucionActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    float filtro[] = {0.1f, 0.1f, 0.1f, 0.1f, 0.2f, 0.1f, 0.1f, 0.1f, 0.1f};
                    Kernel k = new Kernel(3, 3, filtro);
                    ConvolveOp cop = new ConvolveOp(k);
                    BufferedImage imgdest = cop.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_convolucionActionPerformed

    /**
     * Este método se activa cuando cambia el estado del control deslizante de
     * brillo. Obtiene la ventana interna de imagen seleccionada y la imagen
     * fuente original del escritorio. Si ambas existen, aplica un efecto de
     * ajuste de brillo utilizando la clase RescaleOp. El valor del brillo se
     * obtiene del control deslizante y se utiliza en la operación de ajuste.
     * Luego, repinta el lienzo de la ventana interna.
     *
     * @param evt
     */
    private void brilloStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_brilloStateChanged
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null && imgFuente != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    int brillo = this.brillo.getValue();
                    RescaleOp rop = new RescaleOp(1.0F, brillo, null);
                    rop.filter(imgFuente, img);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_brilloStateChanged

    /**
     * Este método se dispara cuando cambia el estado del control deslizante de
     * contraste. Obtiene la ventana interna de imagen seleccionada y la imagen
     * fuente original del escritorio. Si ambas existen, aplica un efecto de
     * ajuste de contraste utilizando la clase RescaleOp. El valor del contraste
     * se obtiene del control deslizante y se utiliza en la operación de ajuste.
     * Luego, repinta el lienzo de la ventana interna.
     *
     * @param evt
     */
    private void ContrasteStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_ContrasteStateChanged
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null && imgFuente != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    float c = ((float) this.Contraste.getValue() / 100.0f);
                    RescaleOp rop = new RescaleOp(c, 0, null);
                    rop.filter(imgFuente, img);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_ContrasteStateChanged

    /**
     * Este método se activa cuando el control de brillo gana el foco. Obtiene
     * la ventana interna de imagen seleccionada del escritorio. Si la ventana
     * interna existe, crea una copia de la imagen original para guardarla en
     * imgFuente. Esta copia se utiliza más adelante para restablecer los
     * valores de brillo.
     *
     * @param evt
     */
    private void brilloFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_brilloFocusGained
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            ColorModel cm = vi.getLienzo2D().getImagen().getColorModel();
            WritableRaster raster = vi.getLienzo2D().getImagen().copyData(null);
            boolean alfaPre = vi.getLienzo2D().getImagen().isAlphaPremultiplied();
            imgFuente = new BufferedImage(cm, raster, alfaPre, null);
        }
    }//GEN-LAST:event_brilloFocusGained
    /**
     * Este método se activa cuando el control de brillo pierde el foco.
     * Restablece imgFuente a null y establece el valor del control deslizante
     * de brillo en 0.
     *
     * @param evt
     */
    private void brilloFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_brilloFocusLost
        imgFuente = null;
        this.brillo.setValue(0);
    }//GEN-LAST:event_brilloFocusLost
    /**
     * Este método se activa cuando el control de contraste gana el foco.
     * Funciona de manera similar a brilloFocusGained, creando una copia de la
     * imagen original para guardarla en imgFuente.
     *
     * @param evt
     */
    private void ContrasteFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_ContrasteFocusGained
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            ColorModel cm = vi.getLienzo2D().getImagen().getColorModel();
            WritableRaster raster = vi.getLienzo2D().getImagen().copyData(null);
            boolean alfaPre = vi.getLienzo2D().getImagen().isAlphaPremultiplied();
            imgFuente = new BufferedImage(cm, raster, alfaPre, null);
        }
    }//GEN-LAST:event_ContrasteFocusGained

    /**
     * Este método recibe un índice de selección y devuelve un objeto Kernel
     * correspondiente. Dependiendo del índice, se selecciona un kernel
     * predefinido utilizando valores de filtro específicos.
     *
     * @param seleccion
     * @return
     */
    private Kernel getKernel(int seleccion) {
        Kernel k = null;
        float filtro[] = null;
        switch (seleccion) {
            case 0:
                filtro = KernelProducer.MASCARA_MEDIA_3x3;
                k = new Kernel(3, 3, filtro);
                break;
            case 1:
                filtro = KernelProducer.MASCARA_BINOMIAL_3x3;
                k = new Kernel(3, 3, filtro);
                break;
            case 2:
                filtro = KernelProducer.MASCARA_ENFOQUE_3x3;
                k = new Kernel(3, 3, filtro);
                break;
            case 3:
                filtro = KernelProducer.MASCARA_RELIEVE_3x3;
                k = new Kernel(3, 3, filtro);
                break;
            case 4:
                filtro = KernelProducer.MASCARA_LAPLACIANA_3x3;
                k = new Kernel(3, 3, filtro);
                break;
            case 5: //5x1
                filtro = new float[]{0.2f, 0.2f, 0.2f, 0.2f, 0.2f};
                k = new Kernel(1, 5, filtro);
                break;
            case 6:
                //medio 5x5
                filtro = new float[]{
                    0.04f, 0.04f, 0.04f, 0.04f, 0.04f,
                    0.04f, 0.04f, 0.04f, 0.04f, 0.04f,
                    0.04f, 0.04f, 0.04f, 0.04f, 0.04f,
                    0.04f, 0.04f, 0.04f, 0.04f, 0.04f,
                    0.04f, 0.04f, 0.04f, 0.04f, 0.04f
                };
                k = new Kernel(5, 5, filtro);
                break;
            case 7:
                //medio 7x7 
                filtro = new float[]{
                    0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f,
                    0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f,
                    0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f,
                    0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f,
                    0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f,
                    0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f,
                    0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f, 0.02f
                };
                k = new Kernel(7, 7, filtro);
                break;
            case 8:
                // Emborronamiento horizontal 7x1
                filtro = new float[]{
                    0.143f, 0.143f, 0.143f, 0.143f, 0.143f, 0.143f, 0.143f
                };
                k = new Kernel(1, 7, filtro);
                break;

            case 9:
                // Emborronamiento horizontal 10x1
                filtro = new float[]{
                    0.1f, 0.1f, 0.1f, 0.1f, 0.1f, 0.1f, 0.1f, 0.1f, 0.1f, 0.1f
                };
                k = new Kernel(1, 10, filtro);
                break;

        }
        return k;
    }

    /**
     * Este método se activa cuando se selecciona una opción de filtro. Obtiene
     * la ventana interna de imagen seleccionada del escritorio. Si la ventana
     * interna existe y tiene una imagen válida, aplica un efecto de filtrado
     * utilizando la clase ConvolveOp. El tipo de filtro se selecciona según el
     * índice del componente de lista desplegable. Se utiliza el método
     * getKernel para obtener el kernel correspondiente. Luego, establece la
     * imagen resultante en el lienzo de la ventana interna y repinta el lienzo.
     *
     * @param evt
     */
    private void filtroActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_filtroActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            int seleccion = this.filtro.getSelectedIndex();
            Kernel k = getKernel(seleccion);
            if (img != null && k != null) {
                try {
                    ConvolveOp cop = new ConvolveOp(k);
                    BufferedImage imgdest = cop.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_filtroActionPerformed

    /**
     * Este método se activa cuando el control de contraste pierde el foco.
     * Restablece imgFuente a null y establece el valor del control deslizante
     * de contraste en 0.
     *
     * @param evt
     */
    private void ContrasteFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_ContrasteFocusLost
        imgFuente = null;
        this.Contraste.setValue(0);
    }//GEN-LAST:event_ContrasteFocusLost

    /**
     * Este método se dispara cuando se selecciona la opción "LookUpOp". Obtiene
     * la ventana interna de imagen seleccionada del escritorio. Si la ventana
     * interna existe y tiene una imagen válida, aplica un efecto de LookupOp
     * para obtener el negativo de la imagen. Luego, establece la imagen
     * resultante en el lienzo de la ventana interna y repinta el lienzo.
     *
     * @param evt
     */
    private void lookUpOpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_lookUpOpActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    byte funcionT[] = new byte[256];
                    for (int x = 0; x < 256; x++) {
                        funcionT[x] = (byte) (255 - x); // Negativo
                    }
                    LookupTable tabla = new ByteLookupTable(0, funcionT);
                    LookupOp lop = new LookupOp(tabla, null);
                    BufferedImage imgdest = lop.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_lookUpOpActionPerformed
    /**
     * Este método se activa cuando se selecciona la opción "AffineTransform".
     * Obtiene la ventana interna de imagen seleccionada del escritorio. Si la
     * ventana interna existe y tiene una imagen válida, aplica una
     * transformación de afinidad para escalar la imagen. Luego, establece la
     * imagen resultante en el lienzo de la ventana interna y repinta el lienzo.
     *
     * @param evt
     */
    private void affineTransformActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_affineTransformActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    AffineTransform at = AffineTransform.getScaleInstance(1.5, 1.5);
                    AffineTransformOp atop = new AffineTransformOp(at, AffineTransformOp.TYPE_BILINEAR);
                    BufferedImage imgdest = atop.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_affineTransformActionPerformed

    /**
     * Este método se dispara cuando se selecciona la opción "Contraste".
     * Obtiene la ventana interna de imagen seleccionada del escritorio. Si la
     * ventana interna existe y tiene una imagen válida, aplica un efecto de
     * ajuste de contraste utilizando una LookupTable predefinida. La imagen
     * resultante se aplica directamente a la imagen original. Luego, repinta el
     * lienzo de la ventana interna.
     *
     * @param evt
     */
    private void contrasteBotonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_contrasteBotonActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    int type = LookupTableProducer.TYPE_SFUNCION;
                    LookupTable lt = LookupTableProducer.createLookupTable(type);
                    LookupOp lop = new LookupOp(lt, null);
                    lop.filter(img, img); // Imagen origen y destino iguales
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_contrasteBotonActionPerformed

    /**
     * Este método crea y devuelve una lookup table utilizada para el ajuste
     * logarítmico de una imagen. Toma dos factores como parámetros, uno para el
     * contraste y otro para la iluminación. Utiliza estos factores para
     * calcular los valores de la lt basados en una fórmula logarítmica.
     *
     * @param factorContraste
     * @param factorIluminacion
     * @return
     */
    private static LookupTable createLogarithmicLookupTable(double factorContraste, double factorIluminacion) {
        double gamma = 1.0 / factorContraste;
        byte[] lutData = new byte[256];
        for (int i = 0; i < lutData.length; i++) {
            double value = 255.0 * Math.pow((double) i / 255.0, gamma) + (factorIluminacion - 0.5) * 255.0;
            lutData[i] = (byte) (value + 0.5);
        }
        return new ByteLookupTable(0, lutData);
    }

    /**
     * Este método se activa cuando se selecciona la opción "Iluminada". Obtiene
     * la ventana interna de imagen seleccionada del escritorio. Si la ventana
     * interna existe y tiene una imagen válida, aplica un efecto de corrección
     * gamma utilizando una lt creada con LookupTableProducer.createLookupTable.
     * El efecto se aplica directamente a la imagen original y se repinta el
     * lienzo de la ventana interna.
     *
     * @param evt
     */
    private void iluminadaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_iluminadaActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    LookupTable lt = LookupTableProducer.createLookupTable(LookupTableProducer.TYPE_GAMMA_CORRECTION);
                    LookupOp lop = new LookupOp(lt, null);
                    lop.filter(img, img); // Imagen origen y destino iguales
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_iluminadaActionPerformed

    /**
     * Este método se activa cuando se selecciona la opción "Oscurecer". Obtiene
     * la ventana interna de imagen seleccionada del escritorio. Si la ventana
     * interna existe y tiene una imagen válida, aplica un efecto de potencia
     * utilizando una lt creada con LookupTableProducer.createLookupTable. El
     * efecto se aplica directamente a la imagen original y se repinta el lienzo
     * de la ventana interna.
     *
     * @param evt
     */
    private void oscurecerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_oscurecerActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    LookupTable lt = LookupTableProducer.createLookupTable(LookupTableProducer.TYPE_POWER);
                    LookupOp lop = new LookupOp(lt, null);
                    lop.filter(img, img); // Imagen origen y destino iguales
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_oscurecerActionPerformed

    /**
     * Este método se activa cuando se selecciona la opción "Rotar". Obtiene la
     * ventana interna de imagen seleccionada del escritorio. Si la ventana
     * interna existe y tiene una imagen válida, aplica una transformación de
     * rotación utilizando AffineTransform. La imagen se rota 180 grados
     * alrededor del centro de la imagen y se establece la imagen resultante en
     * el lienzo de la ventana interna.
     *
     * @param evt
     */
    private void rotarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rotarActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    AffineTransform at = AffineTransform.getRotateInstance(Math.toRadians(180), img.getWidth() / 2, img.getHeight() / 2);
                    AffineTransformOp atop;
                    atop = new AffineTransformOp(at, null);
                    BufferedImage imgdest = atop.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_rotarActionPerformed

    /**
     * Este método se activa cuando se selecciona la opción "BandCombineOp".
     * Obtiene la ventana interna de imagen seleccionada del escritorio. Si la
     * ventana interna existe y tiene una imagen válida, aplica un efecto de
     * combinación de bandas utilizando BandCombineOp. Se utiliza una matriz de
     * valores predefinidos para la combinación de las bandas RGB de la imagen.
     * El efecto se aplica directamente al raster de la imagen y se repinta el
     * lienzo de la ventana interna.
     *
     * @param evt
     */
    private void BandCombineOpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BandCombineOpActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    float[][] matriz = {
                        {0.0F, 0.5F, 0.5F},
                        {0.5F, 0.0F, 0.5F},
                        {0.5F, 0.5F, 0.0F}
                    };
                    BandCombineOp bcop = new BandCombineOp(matriz, null);
                    bcop.filter(img.getRaster(), img.getRaster());
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_BandCombineOpActionPerformed

    /**
     * Este método se activa cuando se selecciona la opción "ColorConvertOp".
     * Obtiene la ventana interna de imagen seleccionada del escritorio. Si la
     * ventana interna existe y tiene una imagen válida, realiza una conversión
     * de espacio de color a escala de grises utilizando ColorConvertOp
     *
     * @param evt
     */
    private void colorConvertOpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_colorConvertOpActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);
                    ColorConvertOp op = new ColorConvertOp(cs, null);
                    BufferedImage imgdest = op.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_colorConvertOpActionPerformed

    /**
     * Este método se activa cuando se selecciona la opción "Aumento". Obtiene
     * la ventana interna de imagen seleccionada del escritorio. Si la ventana
     * interna existe y tiene una imagen válida, aplica una transformación de
     * escala para aumentar el tamaño de la imagen en un 25%.
     *
     * @param evt
     */
    private void aumentoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_aumentoActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    AffineTransform at = AffineTransform.getScaleInstance(1.25, 1.25);
                    AffineTransformOp atop;
                    atop = new AffineTransformOp(at, null);
                    BufferedImage imgdest = atop.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_aumentoActionPerformed

    /**
     * Este método se activa cuando se selecciona la opción "Disminución".
     * Obtiene la ventana interna de imagen seleccionada del escritorio. Si la
     * ventana interna existe y tiene una imagen válida, aplica una
     * transformación de escala para disminuir el tamaño de la imagen en un 25%
     *
     * @param evt
     */
    private void disminucionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_disminucionActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    AffineTransform at = AffineTransform.getScaleInstance(0.75, 0.75);
                    AffineTransformOp atop;
                    atop = new AffineTransformOp(at, null);
                    BufferedImage imgdest = atop.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_disminucionActionPerformed

    /**
     * Este método crea y devuelve una operación de LookupOp para aplicar una
     * transformación lineal con un punto de inflexión. Toma dos parámetros a y
     * b, que representan los puntos de inflexión en los valores de píxeles de
     * entrada y salida. Calcula una lookuptable basada en una función lineal
     * que mapea los valores de píxeles de entrada a los valores de píxeles de
     * salida correspondientes.
     *
     * @param a slider1
     * @param b slider2
     * @return
     */
    private LookupOp linealConInflexion(double a, double b) {
        final int valorMax = 255;
        final int valorMin = 0;

        double m = 0;
        if (a != valorMax) {
            m = (valorMax - b) / (valorMax - a);
        }

        byte funcionL[] = new byte[256];
        for (int x = 0; x < 256; ++x) {
            if (x < a) {
                funcionL[x] = (byte) ((b / a) * x);
            }
            if (x >= a) {
                funcionL[x] = (byte) (m * (x - a) + b);
            }
        }
        LookupTable tabla = new ByteLookupTable(0, funcionL);
        return new LookupOp(tabla, null);
    }

    /**
     * Este método se activa cuando se selecciona la opción "Lineal". Habilita o
     * deshabilita los controles deslizantes (slider1 y slider2) según si la
     * opción "Lineal" está seleccionada o no.
     *
     * @param evt
     */
    private void linealActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_linealActionPerformed
        if (lineal.isSelected()) {
            slider1.setEnabled(true);
            slider2.setEnabled(true);
        }

        if (!lineal.isSelected()) {
            slider1.setEnabled(false);
            slider2.setEnabled(false);
        }
    }//GEN-LAST:event_linealActionPerformed

    /**
     * Función cuadrática f(x) = 1/100(x-m)² siendo 0 <= m <= 255 Esta función
     * recibe un parámetro m y crea y devuelve una lookup table utilizada para
     * aplicar una transformación cuadrática a los valores de los píxeles.
     * Utiliza una fórmula cuadrática para calcular los nuevos valores de los
     * píxeles basados en el parámetro m y los valores originales de los
     * píxeles.
     *
     * @param m
     * @return
     */
    private LookupTable cuadratica(double m) {
        double k = 100.0 * 255.0;
        byte[] data = new byte[256];
        for (int i = 0; i < 256; i++) {
            int v = (int) (((i - m) * (i - m) / k) * 255.0);
            if (v < 0) {
                v = 0;
            }
            if (v > 255) {
                v = 255;
            }
            data[i] = (byte) v;
        }
        return new ByteLookupTable(0, data);
    }

    /**
     * Activa transformación cuadrática.
     *
     * @param evt
     */
    private void cuadraticaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cuadraticaActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    double m = 128.0;
                    LookupTable lt = cuadratica(m);
                    LookupOp lop = new LookupOp(lt, null);
                    lop.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_cuadraticaActionPerformed

    /**
     * Método que devuelve una nueva imagen que contiene solo una banda
     * específica de la imagen original. La nueva imagen se representa en el
     * espacio de color GRAY.
     *
     * @param img (BufferedImage): La imagen original de la cual se extraerá la
     * banda.
     * @param banda (int): El número de la banda a extraer de la imagen
     * original.
     * @return una nueva imagen que representa la banda específica extraída de
     * la imagen original.
     */
    private BufferedImage getImageBand(BufferedImage img, int banda) {
        //Creamos el modelo de color de la nueva imagen basado en un espcio de color GRAY
        ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);
        ComponentColorModel cm = new ComponentColorModel(cs, false, false,
                Transparency.OPAQUE,
                DataBuffer.TYPE_BYTE);
        //Creamos el nuevo raster a partir del raster de la imagen original
        int vband[] = {banda};
        WritableRaster bRaster = (WritableRaster) img.getRaster().createWritableChild(0, 0,
                img.getWidth(), img.getHeight(), 0, 0, vband);
        //Creamos una nueva imagen que contiene como raster el correspondiente a la banda
        return new BufferedImage(cm, bRaster, false, null);
    }

    /**
     * Este método se activa cuando se selecciona la opción "Muestra Banda".
     * Obtiene la ventana interna de imagen seleccionada del escritorio. Si la
     * ventana interna existe y tiene una imagen válida, itera a través de las
     * bandas de la imagen. En cada iteración, llama al método getImageBand para
     * obtener una nueva imagen que representa la banda actual. Luego, crea una
     * nueva ventana interna de imagen, establece la imagen de la banda en su
     * lienzo y la agrega al escritorio
     */
    private void muestraBandaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_muestraBandaActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    for (int i = 0; i < img.getRaster().getNumBands(); ++i) {
                        BufferedImage imgBanda = getImageBand(img, i);
                        vi = new VentanaInternaImagen();
                        vi.getLienzo2D().setImagen(imgBanda);
                        escritorio.add(vi);
                        vi.setVisible(true);
                    }
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_muestraBandaActionPerformed

    /**
     * Método de evento que se dispara cuando se realiza un cambio en la
     * selección del JComboBox cambioEspColor. Convierte la imagen de la ventana
     * interna actual a un espacio de color seleccionado por el usuario.
     * Mediante una estructura de switch-case, se asigna el espacio de color
     * correspondiente al objeto ColorSpace cs según el índice de selección. Se
     * utiliza la clase ColorConvertOp para convertir la imagen original (img)
     * al espacio de color especificado (cs).
     *
     * @param evt
     */
    private void cambioEspColorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cambioEspColorActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                ColorSpace cs = null;
                int seleccion = this.cambioEspColor.getSelectedIndex();
                switch (seleccion) {
                    default:
                        break;
                    case 0:
                        cs = ColorSpace.getInstance(ColorSpace.CS_sRGB);
                        break;
                    case 1:
                        cs = ColorSpace.getInstance(ColorSpace.CS_PYCC);
                        break;
                    case 2:
                        cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);
                        break;

                }
                try {
                    ColorConvertOp op = new ColorConvertOp(cs, null);
                    BufferedImage imgdest = op.filter(img, null);
                    vi = new VentanaInternaImagen();
                    vi.getLienzo2D().setImagen(imgdest);
                    escritorio.add(vi);
                    vi.setVisible(true);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_cambioEspColorActionPerformed

    /**
     * Utiliza la operación BandCombineOp para aplicar la combinación de bandas
     * a la imagen original.
     *
     * @param evt
     */
    private void combinarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_combinarActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();

            if (img != null) {
                try {
                    float[][] matriz = {
                        {0.0F, 0.5F, 0.5F},
                        {0.5F, 0.0F, 0.5F},
                        {0.5F, 0.5F, 0.0F}
                    };
                    BandCombineOp bcop = new BandCombineOp(matriz, null);
                    bcop.filter(img.getRaster(), img.getRaster());
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_combinarActionPerformed

    /**
     * Para la función lineal
     *
     * @param evt
     */
    private void slider1StateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_slider1StateChanged
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    LookupOp lop = linealConInflexion(slider1.getValue(), slider2.getValue());
                    lop.filter(imgFuente, img);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_slider1StateChanged

    /**
     * Para la función lineal
     *
     * @param evt
     */
    private void slider2StateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_slider2StateChanged
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    LookupOp lop = linealConInflexion(slider1.getValue(), slider2.getValue());
                    lop.filter(imgFuente, img);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_slider2StateChanged

    /**
     * Este método se activa cuando el foco se coloca en el control deslizante
     * slider1. Obtiene la ventana interna de imagen seleccionada del
     * escritorio. Si la ventana interna existe, crea una copia de la imagen
     * actual, incluyendo el modelo de color, el raster y la información de
     * alfa. Esta copia se almacena en la variable imgFuente, que se utilizará
     * posteriormente en otros métodos.
     */
    private void slider1FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_slider1FocusGained
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            ColorModel cm = vi.getLienzo2D().getImagen().getColorModel();
            WritableRaster raster = vi.getLienzo2D().getImagen().copyData(null);
            boolean alfaPre = vi.getLienzo2D().getImagen().isAlphaPremultiplied();
            imgFuente = new BufferedImage(cm, raster, alfaPre, null);
        }
    }//GEN-LAST:event_slider1FocusGained

    private void slider1FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_slider1FocusLost
        imgFuente = null;
    }//GEN-LAST:event_slider1FocusLost

    /**
     * Este método se activa cuando el foco se coloca en el control deslizante
     * slider2. Obtiene la ventana interna de imagen seleccionada del
     * escritorio. Si la ventana interna existe, crea una copia de la imagen
     * actual, incluyendo el modelo de color, el raster y la información de
     * alfa. Esta copia se almacena en la variable imgFuente, que se utilizará
     * posteriormente en otros métodos.
     */
    private void slider2FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_slider2FocusGained
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            ColorModel cm = vi.getLienzo2D().getImagen().getColorModel();
            WritableRaster raster = vi.getLienzo2D().getImagen().copyData(null);
            boolean alfaPre = vi.getLienzo2D().getImagen().isAlphaPremultiplied();
            imgFuente = new BufferedImage(cm, raster, alfaPre, null);
        }
    }//GEN-LAST:event_slider2FocusGained

    private void slider2FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_slider2FocusLost
        imgFuente = null;
    }//GEN-LAST:event_slider2FocusLost

    /**
     * El método tintarActionPerformed aplica un efecto de tinte a la imagen
     * seleccionada en la ventana interna. Obtiene la imagen de la ventana
     * interna seleccionada y, si existe, obtiene el color de tinte del lienzo
     * seleccionado. Luego, se crea una instancia de TintOp con el color de
     * tinte y un nivel de opacidad de 0.5. Esta operación de tinte se aplica a
     * la imagen utilizando el método filter, y luego se repinta el lienzo para
     * mostrar la imagen modificada
     *
     * @param evt
     */
    private void tintarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_tintarActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    Color color = this.getLienzoSeleccionado().getColor();
                    TintOp tintado = new TintOp(color, 0.5f);
                    tintado.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_tintarActionPerformed

    /**
     * Aplica un efecto de sepia a la imagen seleccionada en la ventana interna.
     * Al igual que en el método anterior, se obtiene la imagen de la ventana
     * interna seleccionada y, si existe, se crea una instancia de SepiaOp. Esta
     * operación de sepia se aplica a la imagen utilizando el método filter, y
     * luego se repinta el lienzo.
     *
     * @param evt
     */
    private void sepiaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_sepiaActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    SepiaOp sepia = new SepiaOp();
                    sepia.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_sepiaActionPerformed

    /**
     * El método ecualizarActionPerformed aplica una operación de ecualización
     * de histograma a la imagen seleccionada en la ventana interna. Se sigue un
     * proceso similar a los métodos anteriores: se obtiene la imagen de la
     * ventana interna seleccionada, se crea una instancia de EqualizationOp y
     * se aplica la operación de ecualización utilizando el método filter. Luego
     * se repinta el lienzo.
     *
     * @param evt
     */
    private void ecualizarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ecualizarActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    EqualizationOp ecualizacion = new EqualizationOp();
                    ecualizacion.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_ecualizarActionPerformed

    /**
     * El método recalcaRojosActionPerformed recalca los tonos rojos en la
     * imagen seleccionada en la ventana interna. Se obtiene la imagen de la
     * ventana interna seleccionada y, si existe, se crea una instancia de
     * RojoOp con un umbral predefinido. Esta operación de recalcar tonos rojos
     * se aplica a la imagen utilizando el método filter, y luego se repinta el
     * lienzo.
     *
     * @param evt
     */
    private void recalcaRojosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_recalcaRojosActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    final int umbral = 30;
                    RojoOp rojo = new RojoOp(umbral);
                    rojo.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_recalcaRojosActionPerformed

    /**
     *
     * @param evt
     */
    private void sliderVariaTonoStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_sliderVariaTonoStateChanged
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    TonoOp tono = new TonoOp(sliderVariaTono.getValue());
                    tono.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_sliderVariaTonoStateChanged

    /**
     *
     * @param evt
     */
    private void sliderPosterizarStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_sliderPosterizarStateChanged
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    PosterizarOp pop = new PosterizarOp(sliderPosterizar.getValue());
                    pop.filter(imgFuente, img);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_sliderPosterizarStateChanged

    /**
     * Boton que abre sonidos de prueba. Implementación correcta (que distingue
     * entre tipo de fichero) en los otros botones abrir.
     *
     * @param evt
     */
    private void abrirSonidoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_abrirSonidoActionPerformed
        JFileChooser dlg = new JFileChooser();
        int resp = dlg.showOpenDialog(this);
        if (resp == JFileChooser.APPROVE_OPTION) {
            try {
                File f = new File(dlg.getSelectedFile().getAbsolutePath()) {
                    @Override
                    public String toString() {
                        return this.getName();
                    }
                };
                this.sonidos.addItem(f);
                this.sonidos.setSelectedItem(f);
            } catch (Exception ex) {
                System.err.print("Error al abrir el sonido");
            }
        }
    }//GEN-LAST:event_abrirSonidoActionPerformed

    /**
     * Reproduce un sonido
     *
     * @param evt
     */
    private void playActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_playActionPerformed
        File f = (File) sonidos.getSelectedItem();
        if (f != null) {
            player = new SMClipPlayer(f);
            if (player != null) {
                player.addLineListener(new ManejadorAudio());
                player.play();
                isPlaying = true;
            }
        }
    }//GEN-LAST:event_playActionPerformed

    /**
     * Para un sonido
     *
     * @param evt
     */
    private void stopActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_stopActionPerformed
        if (player != null) {
            player.stop();
            player = null;
        }
        if (recorder != null) {
            recorder.stop();
            recorder = null;
        }

    }//GEN-LAST:event_stopActionPerformed


    private void sliderPosterizarFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_sliderPosterizarFocusGained
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            ColorModel cm = vi.getLienzo2D().getImagen().getColorModel();
            WritableRaster raster = vi.getLienzo2D().getImagen().copyData(null);
            boolean alfaPre = vi.getLienzo2D().getImagen().isAlphaPremultiplied();
            imgFuente = new BufferedImage(cm, raster, alfaPre, null);
        }
    }//GEN-LAST:event_sliderPosterizarFocusGained

    private void sliderPosterizarFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_sliderPosterizarFocusLost
        imgFuente = null;
    }//GEN-LAST:event_sliderPosterizarFocusLost

    /**
     * Este método de se encarga de volcar en una imagen las figuras que
     * seleccionemos de nuestra lista lateral. Para ello recorremos de forma
     * inversa nuestro vector de formas a borrar y usamos el método vuelca del
     * liezno2D que es que se encargará de realizar el volcado de figuras a la
     * imagen una por una.
     *
     * @param evt
     */
    private void volcarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_volcarActionPerformed
        int formasBorrar[];
        DefaultListModel modelo = (DefaultListModel) listaLateral.getModel();
        formasBorrar = listaLateral.getSelectedIndices();
        for (int i = formasBorrar.length - 1; i >= 0; i--) {
            int indiceBorrar = formasBorrar[i] - i;
            this.getLienzoSeleccionado().vuelca(indiceBorrar);
            modelo.remove(indiceBorrar);
        }

        listaLateral.setModel(modelo);
    }//GEN-LAST:event_volcarActionPerformed

    private void sliderVariaTonoFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_sliderVariaTonoFocusGained
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            ColorModel cm = vi.getLienzo2D().getImagen().getColorModel();
            WritableRaster raster = vi.getLienzo2D().getImagen().copyData(null);
            boolean alfaPre = vi.getLienzo2D().getImagen().isAlphaPremultiplied();
            imgFuente = new BufferedImage(cm, raster, alfaPre, null);
        }
    }//GEN-LAST:event_sliderVariaTonoFocusGained

    private void sliderVariaTonoFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_sliderVariaTonoFocusLost
        imgFuente = null;
    }//GEN-LAST:event_sliderVariaTonoFocusLost

    /**
     * Método que se encarga de grabar sonidos. Posible mejora: Diálogo después
     * de grabar el audio.
     *
     * @param evt
     */
    private void grabarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_grabarActionPerformed
        JFileChooser dlg = new JFileChooser();
        int resp = dlg.showSaveDialog(this);
        if (resp == JFileChooser.APPROVE_OPTION) {
            try {
                File f = dlg.getSelectedFile();
                recorder = new SMSoundRecorder(f);
                if (recorder != null) {
                    recorder.record();
                }
            } catch (Exception ex) {
                System.err.print("Error al guardar el sonido");
            }
        }
    }//GEN-LAST:event_grabarActionPerformed

    /**
     * Método encargado de gestionar el botón de pausa.
     *
     * @param evt
     */
    private void pauseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_pauseActionPerformed
        if (player != null) {
            if (isPlaying) {
                if (isPaused) {
                    player.resume();
                    isPaused = false;
                } else {
                    player.pause();
                    isPaused = true;
                }
            } else {
                player.play();
                isPlaying = true;
            }
        }
    }//GEN-LAST:event_pauseActionPerformed

    private void camaraActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_camaraActionPerformed
        VentanaInternaCamara vc = VentanaInternaCamara.getInstance();
        if (vc != null) {
            escritorio.add(vc);
            vc.setVisible(true);
        }
    }//GEN-LAST:event_camaraActionPerformed

    /**
     * Este método se encarga de realizar una instantanea de nuestra cámara y
     * mostrarla en un lienzo nuevo.
     *
     * @param evt
     */
    private void capturaInstantaneaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_capturaInstantaneaActionPerformed
        VentanaInternaCamara vc = (VentanaInternaCamara) escritorio.getSelectedFrame();
        if (vc != null) {
            BufferedImage img = vc.getImage();
            VentanaInternaImagen vi = new VentanaInternaImagen();
            vi.getLienzo2D().setImagen(img);
            vi.getLienzo2D().addLienzoListener(new ManejadorLienzo());
            vi.addInternalFrameListener(new ManejadorVentanaInterna());
            escritorio.add(vi);
            vi.setVisible(true);
            vi.setTitle("Instantanea");

        }
    }//GEN-LAST:event_capturaInstantaneaActionPerformed

    /**
     * Incia el video.
     *
     * @param evt
     */
    private void playVideoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_playVideoActionPerformed
        VentanaInternaVideo vv = (VentanaInternaVideo) escritorio.getSelectedFrame();
        if (vv != null) {
            vv.play();
        }
    }//GEN-LAST:event_playVideoActionPerformed

    /**
     * Detiene el video.
     *
     * @param evt
     */
    private void stopVideoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_stopVideoActionPerformed
        VentanaInternaVideo vv = (VentanaInternaVideo) escritorio.getSelectedFrame();
        if (vv != null) {
            vv.stop();
        }
    }//GEN-LAST:event_stopVideoActionPerformed

    /**
     * Botón que se encarga de hacer saber a mi lienzo si tenemos que dibujar
     * figuras rellenas o no.
     *
     * @param evt
     */
    private void relleno2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_relleno2ActionPerformed
        this.getLienzoSeleccionado().setRelleno(relleno2.isSelected());
    }//GEN-LAST:event_relleno2ActionPerformed

    /**
     * JSpinner para establecer el tipo de discontinuidad.
     *
     * @param evt
     */
    private void spinnerDiscontnuidadStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_spinnerDiscontnuidadStateChanged
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setDiscontinuidad(Integer.parseInt(spinnerDiscontnuidad.getValue().toString()));
        }
    }//GEN-LAST:event_spinnerDiscontnuidadStateChanged

    /////////////////////SETTERS DE COLORES DE RELLENO////////////////

    private void negro2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_negro2ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColorRelleno(Color.black);
        }
    }//GEN-LAST:event_negro2ActionPerformed

    private void rojo2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rojo2ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColorRelleno(Color.red);
        }
    }//GEN-LAST:event_rojo2ActionPerformed

    private void azul2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_azul2ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColorRelleno(Color.blue);
        }
    }//GEN-LAST:event_azul2ActionPerformed

    private void amarillo2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_amarillo2ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColorRelleno(Color.yellow);
        }
    }//GEN-LAST:event_amarillo2ActionPerformed

    private void verde2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_verde2ActionPerformed
        if (hayLienzo()) {
            this.getLienzoSeleccionado().setColorRelleno(Color.green);
        }
    }//GEN-LAST:event_verde2ActionPerformed

    private void masColores1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_masColores1ActionPerformed
        if (hayLienzo()) {
            Color color = JColorChooser.showDialog(this, "Elija un color", Color.red);
            this.getLienzoSeleccionado().setColorRelleno(color);
        }
    }//GEN-LAST:event_masColores1ActionPerformed

    /**
     * aplica un efecto de negativo a la imagen seleccionada en la ventana
     * interna. Se obtiene la imagen de la ventana interna seleccionada y, si
     * existe, se crea una instancia de RescaleOp con un factor de escala de
     * -1.0 y un desplazamiento de 255. Esta operación de negativo se aplica a
     * la imagen utilizando el método filter, y luego se establece la imagen
     * resultante en la ventana interna y se repinta el lienzo.
     *
     * @param evt
     */
    private void negativoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_negativoActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    RescaleOp op = new RescaleOp(-1.0f, 255f, null);
                    BufferedImage imgdest = op.filter(img, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (IllegalArgumentException e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_negativoActionPerformed

    /**
     * Duplica la imagen de la ventana interna seleccionada y la muestra en una
     * nueva ventana interna. Se obtiene la ventana interna de imagen
     * seleccionada y, si existe, se obtiene la imagen de la misma. Luego se
     * crea una nueva instancia de VentanaInternaImagen, se establece la imagen
     * duplicada en el lienzo de la nueva ventana interna y se agrega la nueva
     * ventana interna al escritorio. Se asigna un título a la nueva ventana
     * interna y se muestra.
     *
     * @param evt
     */
    private void duplicarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_duplicarActionPerformed
        VentanaInternaImagen vc = (VentanaInternaImagen) escritorio.getSelectedFrame();
        if (vc != null) {
            BufferedImage img = vc.getLienzo2D().getImagen(true);
            VentanaInternaImagen vi = new VentanaInternaImagen();
            vi.getLienzo2D().setImagen(img);
            vi.getLienzo2D().addLienzoListener(new ManejadorLienzo());
            vi.addInternalFrameListener(new ManejadorVentanaInterna());
            escritorio.add(vi);
            vi.setVisible(true);
            vi.setTitle("Duplicada");

        }
    }//GEN-LAST:event_duplicarActionPerformed

    /**
     * Captura una instantánea de video y la muestra como una imagen en una
     * nueva ventana interna. Se obtiene la ventana interna de video
     * seleccionada y, si existe, se obtiene la imagen actual del video. Luego
     * se crea una nueva instancia de VentanaInternaImagen, se establece la
     * imagen capturada en el lienzo de la nueva ventana interna y se agrega la
     * nueva ventana interna al escritorio. Se asigna un título a la nueva
     * ventana interna y se muestra.
     *
     * @param evt
     */
    private void instantaneaVideoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_instantaneaVideoActionPerformed
        VentanaInternaVideo vc = (VentanaInternaVideo) escritorio.getSelectedFrame();
        if (vc != null) {
            BufferedImage img = vc.getImage();
            VentanaInternaImagen vi = new VentanaInternaImagen();
            vi.getLienzo2D().setImagen(img);
            vi.getLienzo2D().addLienzoListener(new ManejadorLienzo());
            vi.addInternalFrameListener(new ManejadorVentanaInterna());
            escritorio.add(vi);
            vi.setVisible(true);
            vi.setTitle("Instantanea");

        }
    }//GEN-LAST:event_instantaneaVideoActionPerformed

    /**
     * El método recalca los tonos azules en la imagen seleccionada en la
     * ventana interna. Se obtiene la imagen de la ventana interna seleccionada
     * y, si existe, se crea una instancia de AzulOp con un umbral predefinido.
     * Esta operación de recalcar tonos azules se aplica a la imagen utilizando
     * el método filter, y luego se repinta el lienzo.
     *
     * @param evt
     */
    private void azulOpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_azulOpActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    final int umbral = 30;
                    AzulOp Azul = new AzulOp(umbral);
                    Azul.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_azulOpActionPerformed

    /////////////////////////////////////////////////////////////////////////

    private void sliderGiroStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_sliderGiroStateChanged
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            if (imgFuente != null) {
                try {
                    double radians = Math.toRadians(sliderGiro.getValue());
                    AffineTransform at = AffineTransform.getRotateInstance(radians, imgFuente.getWidth() / 2, imgFuente.getHeight() / 2);
                    AffineTransformOp atop;
                    atop = new AffineTransformOp(at, AffineTransformOp.TYPE_BILINEAR);
                    BufferedImage imgdest = atop.filter(imgFuente, null);
                    vi.getLienzo2D().setImagen(imgdest);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_sliderGiroStateChanged



    private void sliderGiroFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_sliderGiroFocusGained
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            this.imgFuente = vi.getLienzo2D().getImagen();
        }
    }//GEN-LAST:event_sliderGiroFocusGained

    private void sliderGiroFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_sliderGiroFocusLost
        this.imgFuente = null;
        sliderGiro.setValue(0);
    }//GEN-LAST:event_sliderGiroFocusLost

    /**
     * Este operador convierte una imagen en escala de grises en una imagen
     * binaria, donde cada píxel es o bien blanco o bien negro, dependiendo de
     * si su valor de intensidad es mayor o menor que un cierto umbral.
     *
     * @param umbral el umbral que pasemos
     * @return new ByteLookupTable
     */
    private LookupTable umbralizacionBinaria(int umbral) {
        byte[] data = new byte[256];
        for (int i = 0; i < 256; i++) {
            data[i] = (byte) (i < umbral ? 0 : 255);
        }
        return new ByteLookupTable(0, data);
    }


    private void umbralizacionBinariaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_umbralizacionBinariaActionPerformed
        VentanaInternaImagen vi = (VentanaInternaImagen) (escritorio.getSelectedFrame());
        if (vi != null) {
            BufferedImage img = vi.getLienzo2D().getImagen();
            if (img != null) {
                try {
                    int umbral = 128;
                    LookupTable lt = umbralizacionBinaria(umbral);
                    LookupOp lop = new LookupOp(lt, null);
                    lop.filter(img, img);
                    vi.getLienzo2D().repaint();
                } catch (Exception e) {
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_umbralizacionBinariaActionPerformed

    /**
     * Clase Manejadora de audio
     */
    class ManejadorAudio implements LineListener {

        @Override
        public void update(LineEvent event) {
            if (event.getType() == LineEvent.Type.START) {
                play.setEnabled(false);
            }
            if (event.getType() == LineEvent.Type.STOP) {
                play.setEnabled(true);
            }
            if (event.getType() == LineEvent.Type.CLOSE) {
            }
        }
    }

    /**
     * Este método se usa en los actionPerformed de abrir para poder distinguir
     * tipo de archivo.
     *
     * @param file Archivo a pasar
     * @return Extensión
     */
    private String getFileExtension(File file) {
        String name = file.getName();
        int lastIndexOf = name.lastIndexOf(".");
        if (lastIndexOf == -1) {
            return ""; // empty extension
        }
        return name.substring(lastIndexOf);
    }

    /**
     * Método que se encarga de coger la imagen del lienzo
     *
     * @return Image del lienzo seleccionado.
     */
    BufferedImage getImagenLienzo() {
        return this.getLienzoSeleccionado().getImagen();
    }

    /**
     * Método que se encarga de devolver el lienzo seleccionado.
     *
     * @return
     */
    Lienzo2D getLienzoSeleccionado() {
        VentanaInternaImagen vi = (VentanaInternaImagen) escritorio.getSelectedFrame();
        return vi != null ? vi.getLienzo2D() : null;
    }

    /**
     * Método que comprueba que hay un lienzo seleccionado.
     *
     * @return
     */
    boolean hayLienzo() {
        return this.getLienzoSeleccionado() != null;

    }

    boolean esVideo() {
        return false;
    }

    /**
     * Clase que herede de LienzoAdapter.
     */
    public class ManejadorLienzo extends LienzoAdapter {

        /**
         * Método para añadir el elemento a la lista lateral.
         *
         * @param evt
         */
        public void shapeAdded(LienzoEvent evt) {
            Forma s = evt.getFigura();
            ((DefaultListModel) listaLateral.getModel()).addElement(s);
        }
    }

    public class ManejadorVentanaInterna extends InternalFrameAdapter {

        public void internalFrameActivated(InternalFrameEvent evt) {
            VentanaInternaImagen vi = (VentanaInternaImagen) evt.getInternalFrame();
            DefaultListModel modelo = new DefaultListModel();
            modelo.addAll(vi.getLienzo2D().getNewShapeList());
            listaLateral.setModel(modelo);
        }

        public void internalFrameClosing(InternalFrameEvent evt) {
            ((DefaultListModel) listaLateral.getModel()).removeAllElements();
        }
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;

                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(VentanaPrincipal.class
                    .getName()).log(java.util.logging.Level.SEVERE, null, ex);

        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(VentanaPrincipal.class
                    .getName()).log(java.util.logging.Level.SEVERE, null, ex);

        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(VentanaPrincipal.class
                    .getName()).log(java.util.logging.Level.SEVERE, null, ex);

        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(VentanaPrincipal.class
                    .getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        boolean ok = new NativeDiscovery().discover();
        if (!ok) {
            System.err.print("VLC no encontrado");
        } else {
            System.out.print("VLC encontrado");
        }

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new VentanaPrincipal().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JMenuItem Abrir;
    private javax.swing.JMenu Archivo;
    private javax.swing.JMenuItem BandCombineOp;
    private javax.swing.JSlider Contraste;
    private javax.swing.JMenu Edicion;
    private javax.swing.JMenuItem Guardar;
    private javax.swing.JMenu Imagen;
    private javax.swing.JMenuItem Nuevo;
    private javax.swing.JMenuItem Salir;
    private javax.swing.JMenuItem abreImagen;
    private javax.swing.JButton abrir;
    private javax.swing.JMenuItem abrirSonido;
    private javax.swing.JMenuItem affineTransform;
    private javax.swing.JToggleButton alisar;
    private javax.swing.JToggleButton amarillo1;
    private javax.swing.JToggleButton amarillo2;
    private javax.swing.JButton aumento;
    private javax.swing.JToggleButton azul1;
    private javax.swing.JToggleButton azul2;
    private javax.swing.JButton azulOp;
    private javax.swing.JCheckBoxMenuItem barraEstado;
    private javax.swing.JLabel barraEstado2;
    private javax.swing.JSlider brillo;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JButton camara;
    private javax.swing.JComboBox<String> cambioEspColor;
    private javax.swing.JButton capturaInstantanea;
    private javax.swing.JMenuItem colorConvertOp;
    private javax.swing.JPanel colores1;
    private javax.swing.JPanel colores2;
    private javax.swing.JButton combinar;
    private javax.swing.JButton contrasteBoton;
    private javax.swing.JMenuItem convolucion;
    private javax.swing.JToggleButton cuadrado;
    private javax.swing.JButton cuadratica;
    private javax.swing.JToggleButton curva;
    private javax.swing.JToggleButton dibujoLibre;
    private javax.swing.JButton disminucion;
    private javax.swing.JButton duplicar;
    private javax.swing.JButton ecualizar;
    private javax.swing.JToggleButton elipse;
    private javax.swing.JDesktopPane escritorio;
    private javax.swing.JComboBox<String> filtro;
    private javax.swing.JButton grabar;
    private javax.swing.JButton guardar;
    private javax.swing.JButton iluminada;
    private javax.swing.JButton instantaneaVideo;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JPopupMenu.Separator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JToolBar jToolBar1;
    private javax.swing.JToggleButton linea;
    private javax.swing.JToggleButton lineal;
    private javax.swing.JList<Forma> listaLateral;
    private javax.swing.JMenuItem lookUpOp;
    private javax.swing.JToggleButton masColores;
    private javax.swing.JToggleButton masColores1;
    private javax.swing.JMenuItem menuNuevo;
    private javax.swing.JButton muestraBanda;
    private javax.swing.JButton negativo;
    private javax.swing.JToggleButton negro1;
    private javax.swing.JToggleButton negro2;
    private javax.swing.JButton nuevo;
    private javax.swing.JButton oscurecer;
    private javax.swing.JSplitPane panelDividido;
    private javax.swing.JPanel panelSonido;
    private javax.swing.JButton pause;
    private javax.swing.JButton play;
    private javax.swing.JButton playVideo;
    private javax.swing.JButton recalcaRojos;
    private javax.swing.JMenuItem reescalado;
    private javax.swing.JToggleButton relleno2;
    private javax.swing.JToggleButton rojo1;
    private javax.swing.JToggleButton rojo2;
    private javax.swing.JButton rotar;
    private javax.swing.JToggleButton seleccion;
    private javax.swing.JButton sepia;
    private javax.swing.JSlider slider1;
    private javax.swing.JSlider slider2;
    private javax.swing.JSlider sliderGiro;
    private javax.swing.JSlider sliderPosterizar;
    private javax.swing.JSlider sliderVariaTono;
    private javax.swing.JToggleButton smile;
    private javax.swing.JComboBox<File> sonidos;
    private javax.swing.JSpinner spinner;
    private javax.swing.JSpinner spinnerDiscontnuidad;
    private javax.swing.JButton stop;
    private javax.swing.JButton stopVideo;
    private javax.swing.JButton tintar;
    private javax.swing.JToggleButton transparencia;
    private javax.swing.JButton umbralizacionBinaria;
    private javax.swing.JToggleButton verde1;
    private javax.swing.JToggleButton verde2;
    private javax.swing.JButton volcar;
    // End of variables declaration//GEN-END:variables
}
